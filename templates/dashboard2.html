<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard 2 - Hotel Booking Analytics</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', Arial, sans-serif; }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">Hotel Booking Dashboard</a>
            <div class="navbar-nav">
                <a class="nav-link" href="/">Dashboard 1</a>
                <a class="nav-link active" href="/dashboard2">Dashboard 2</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1 class="text-center mb-4 fw-bold display-4">Bookings Overview</h1>
        
        <!-- Filters -->
        <form method="GET" class="row mb-4" id="filterForm">
            <div class="col-md-4">
                <select id="hotelFilter" name="hotel" class="form-select">
                    <option value="">All Hotels</option>
                    <option value="City Hotel">City Hotel</option>
                    <option value="Resort Hotel">Resort Hotel</option>
                </select>
            </div>
            <div class="col-md-4">
                <select id="yearFilter" name="year" class="form-select">
                    <option value="">All Years</option>
                    <option value="2015">2015</option>
                    <option value="2016">2016</option>
                    <option value="2017">2017</option>
                </select>
            </div>
            <div class="col-md-4">
                <select id="monthFilter" name="month" class="form-select">
                    <option value="">All Months</option>
                    <option value="January">January</option>
                    <option value="February">February</option>
                    <option value="March">March</option>
                    <option value="April">April</option>
                    <option value="May">May</option>
                    <option value="June">June</option>
                    <option value="July">July</option>
                    <option value="August">August</option>
                    <option value="September">September</option>
                    <option value="October">October</option>
                    <option value="November">November</option>
                    <option value="December">December</option>
                </select>
            </div>
            <div class="col-12 mt-2 text-center">
                <button type="submit" class="btn btn-primary">Apply Filters</button>
            </div>
        </form>

        <!-- Chart Data from Flask (JSON) -->
        <script id="cancelBySegmentData" type="application/json">{{ cancel_by_segment|tojson }}</script>
        <script id="leadVsAdrData" type="application/json">{{ lead_vs_adr|tojson }}</script>
        <script id="revenueByChannelData" type="application/json">{{ revenue_by_channel|tojson }}</script>
        <script id="specialRequestsData" type="application/json">{{ special_requests|tojson }}</script>
        <script id="repeatGuestsData" type="application/json">{{ repeat_guests|tojson }}</script>

        <!-- Charts -->
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">Cancellations by Market Segment</div>
                    <div class="card-body">
                        <canvas id="cancelBySegmentChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">ADR vs Lead Time</div>
                    <div class="card-body">
                        <canvas id="leadVsAdrChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">Revenue by Distribution Channel</div>
                    <div class="card-body">
                        <canvas id="revenueByChannelChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">Special Requests by Customer Type</div>
                    <div class="card-body">
                        <canvas id="specialRequestsChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">Repeat vs New Guests</div>
                    <div class="card-body">
                        <canvas id="repeatGuestsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Parse chart data from JSON script tags
        const cancelBySegment = JSON.parse(document.getElementById('cancelBySegmentData').textContent || '[]');
        const leadVsAdr = JSON.parse(document.getElementById('leadVsAdrData').textContent || '[]');
        const revenueByChannel = JSON.parse(document.getElementById('revenueByChannelData').textContent || '[]');
        const specialRequests = JSON.parse(document.getElementById('specialRequestsData').textContent || '[]');
        const repeatGuests = JSON.parse(document.getElementById('repeatGuestsData').textContent || '[]');

        // Chart 1: Cancellations by Market Segment (Grouped Bar Chart)
        const cancelBySegmentCtx = document.getElementById('cancelBySegmentChart').getContext('2d');
        const cancelBySegmentChart = new Chart(cancelBySegmentCtx, {
            type: 'bar',
            data: {
                labels: cancelBySegment.map(item => item[0]),
                datasets: [
                    {
                        label: 'Canceled',
                        data: cancelBySegment.map(item => item[1]),
                        backgroundColor: 'rgba(255, 99, 132, 0.5)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Not Canceled',
                        data: cancelBySegment.map(item => item[2]),
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Chart 2: ADR vs Lead Time (Scatter Plot)
        const leadVsAdrCtx = document.getElementById('leadVsAdrChart').getContext('2d');
        new Chart(leadVsAdrCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'ADR vs Lead Time',
                    data: leadVsAdr.map(item => ({ x: item[0], y: item[1] })),
                    backgroundColor: 'rgba(153, 102, 255, 0.5)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    x: { title: { display: true, text: 'Lead Time' } },
                    y: { title: { display: true, text: 'ADR' } }
                }
            }
        });

        // Chart 3: Revenue by Distribution Channel (Horizontal Bar Chart)
        const revenueByChannelCtx = document.getElementById('revenueByChannelChart').getContext('2d');
        new Chart(revenueByChannelCtx, {
            type: 'bar',
            data: {
                labels: revenueByChannel.map(item => item[0]),
                datasets: [{
                    label: 'Revenue',
                    data: revenueByChannel.map(item => item[1]),
                    backgroundColor: 'rgba(75, 192, 192, 0.5)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                scales: {
                    x: { beginAtZero: true }
                }
            }
        });

        // Chart 4: Special Requests by Customer Type (Radar Chart)
        const specialRequestsCtx = document.getElementById('specialRequestsChart').getContext('2d');
        new Chart(specialRequestsCtx, {
            type: 'radar',
            data: {
                labels: specialRequests.map(item => item[0]),
                datasets: [{
                    label: 'Average Special Requests',
                    data: specialRequests.map(item => item[1]),
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            }
        });

        // Chart 5: Repeat vs New Guests (Donut Chart)
        const repeatGuestsCtx = document.getElementById('repeatGuestsChart').getContext('2d');
        new Chart(repeatGuestsCtx, {
            type: 'doughnut',
            data: {
                labels: ['New Guests', 'Repeat Guests'],
                datasets: [{
                    data: repeatGuests.map(item => item[1]),
                    backgroundColor: ['rgba(201, 203, 207, 0.5)', 'rgba(255, 159, 64, 0.5)'],
                    borderColor: ['rgba(201, 203, 207, 1)', 'rgba(255, 159, 64, 1)'],
                    borderWidth: 1
                }]
            }
        });

        let topCountriesChart;

        function updateAllCharts() {
            updateCancelBySegmentChart();
            updateLeadVsAdrChart();
            updateRevenueByChannelChart();
            updateSpecialRequestsChart();
            updateRepeatGuestsChart();
        }

        function getFilters() {
            return {
                hotel: document.getElementById('hotelFilter').value || "All Hotels",
                year: document.getElementById('yearFilter').value || "All Years",
                month: document.getElementById('monthFilter').value || "All Months"
            };
        }

        function updateDashboard() {
            const filters = getFilters();
            const query = `hotel=${encodeURIComponent(filters.hotel)}&year=${encodeURIComponent(filters.year)}&month=${encodeURIComponent(filters.month)}`;
            fetch(`/dashboard1?${query}`)
                .then(res => res.text())
                .then(html => {
                    // Optionally, update the page or fetch JSON for charts
                });
        }

        function updateCancelBySegmentChart() {
            const filters = getFilters();
            const query = `hotel=${filters.hotel}&year=${filters.year}&month=${filters.month}`;
            fetch(`/api/cancel_by_segment?${query}`)
                .then(res => res.json())
                .then(data => {
                    cancelBySegmentChart.data.labels = data.labels;
                    cancelBySegmentChart.data.datasets[0].data = data.canceled;
                    cancelBySegmentChart.data.datasets[1].data = data.not_canceled;
                    cancelBySegmentChart.update();
                });
        }

        function updateLeadVsAdrChart() {
            const filters = getFilters();
            const query = `hotel=${encodeURIComponent(filters.hotel)}&year=${encodeURIComponent(filters.year)}&month=${encodeURIComponent(filters.month)}`;
            fetch(`/api/lead_vs_adr?${query}`)
                .then(res => res.json())
                .then(data => {
                    // Implementation of updateLeadVsAdrChart function
                });
        }

        function updateRevenueByChannelChart() {
            const filters = getFilters();
            const query = `hotel=${encodeURIComponent(filters.hotel)}&year=${encodeURIComponent(filters.year)}&month=${encodeURIComponent(filters.month)}`;
            fetch(`/api/revenue_by_channel?${query}`)
                .then(res => res.json())
                .then(data => {
                    // Implementation of updateRevenueByChannelChart function
                });
        }

        function updateSpecialRequestsChart() {
            const filters = getFilters();
            const query = `hotel=${encodeURIComponent(filters.hotel)}&year=${encodeURIComponent(filters.year)}&month=${encodeURIComponent(filters.month)}`;
            fetch(`/api/special_requests?${query}`)
                .then(res => res.json())
                .then(data => {
                    // Implementation of updateSpecialRequestsChart function
                });
        }

        function updateRepeatGuestsChart() {
            const filters = getFilters();
            const query = `hotel=${encodeURIComponent(filters.hotel)}&year=${encodeURIComponent(filters.year)}&month=${encodeURIComponent(filters.month)}`;
            fetch(`/api/repeat_guests?${query}`)
                .then(res => res.json())
                .then(data => {
                    // Implementation of updateRepeatGuestsChart function
                });
        }

        // Add event listeners
        ['hotelFilter', 'yearFilter', 'monthFilter'].forEach(id => {
            document.getElementById(id).addEventListener('change', updateAllCharts);
        });

        // Initialize charts
        window.onload = function() {
            // Initial load
            updateAllCharts();
        };

        hotelChart = new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: 'City Hotel',
                    data: [],
                    backgroundColor: '#36A2EB'
                }, {
                    label: 'Resort Hotel',
                    data: [],
                    backgroundColor: '#4BC0C0'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true },
                    tooltip: { enabled: true }
                },
                scales: { y: { beginAtZero: true } }
            }
        });
    </script>
</body>
</html> 